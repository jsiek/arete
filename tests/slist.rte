var null = function -> ! { return new ⟨⟩; };
var push = function data, !list -> ! {
  return new ⟨ data, !list ⟩;
};
var head = function list {
  return (*list)[0];
};
var tail = function list {
  return (*list)[1];
};
// mutable access to the tail
var mtail = function list -> ! {
  return (*list)[1];
};
var is_null = function ptr {
  match *ptr
  | case ⟨⟩:
    return true;
  | case ⟨_, _⟩:
    return false;
};
var is_last = function n {
  if is_null(n) then
    return false;
  else {
    return is_null(tail(n));
  }
};
// Split the list into two parts, with the second
// part just containing the last element.
var remove_last = function !n -> ! {
  if is_null(n) then
    return 0;
  else if is_last(tail(n)) then {
      var !q = mtail(n);
      n := ⟨head(n), !null()⟩;
      return q;
  } else {
    return remove_last(mtail(n));
  }
};
var delete_list = function !n {
  if is_null(n) then
    delete n;
  else {
    delete_list(mtail(n));
    delete n;
  }
};
var !one_two = push(1, push(2, null()));
var !two_null = remove_last(one_two);
var one = head(one_two);
var two = head(two_null);
delete_list(one_two);
delete_list(two_null);
return one + one - two;
