var null = fn { return new ⟨⟩; };
var push = fn data, write list {
  return new ⟨ data, write (list ! none) ⟩;
};
var head = fn list {
  match *list
  | case ⟨hd, tl⟩:
    return hd;
};
var tail = fn list {
  match *list
  | case ⟨hd, tl⟩:
    return tl;     // return creates a copy, but that aliases with the cdr
};
var is_null = fn ptr {
  match *ptr
  | case ⟨⟩:
    return true;
  | case ⟨_, _⟩:
    return false;
};
var is_last = fn n {
  match *n
  | case ⟨⟩:
    return false;
  | case ⟨_, next⟩: {
    return is_null(next);
  }
};

var remove_last = fn write n {
  if is_null(n) then
    return 0;
  else if is_last(tail(n)) then {
    match *n
    | case ⟨data, p⟩:
      n := ⟨data, null()⟩;
      return p;
  } else {
    match *n
    | case ⟨data, write p⟩:
      return remove_last(p);
  }
};
var delete_list = fn write n {
  {
    match *n
    | case ⟨⟩:
    | case ⟨data, write p⟩:
      delete_list(p);
  }
  delete n;
};
var one_two = write push(1, push(2, (null() ! write)));
var two_null = remove_last(one_two);
var one = head(one_two);
var two = head(two_null);
delete_list(one_two);
delete_list(two_null);
return one + 1 - two;
